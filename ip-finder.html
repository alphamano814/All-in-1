<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- SEO Meta Tags -->
  <title>IP Finder — Public & Local IP, Geolocation & ISP</title>
  <meta name="description" content="Find your public and local IP addresses, geolocation, ISP, ASN, and view location on a map. Privacy-first IP lookup tool.">
  <meta name="keywords" content="ip finder, ip address, public ip, local ip, geolocation, isp, asn, ip lookup, network tools">
  <meta name="author" content="Prabin's Toolbox">
  <link rel="canonical" href="https://www.prabinpokhrel1.com.np/ip-finder.html">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="IP Finder — Public & Local IP, Geolocation & ISP">
  <meta property="og:description" content="Find your public and local IP addresses, geolocation, ISP, ASN, and view location on a map. Privacy-first IP lookup tool.">
  <meta property="og:image" content="https://www.prabinpokhrel1.com.np/images/ip-finder-og.jpg">
  <meta property="og:url" content="https://www.prabinpokhrel1.com.np/ip-finder.html">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="All-in-One Tools by Prabin">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="IP Finder — Public & Local IP, Geolocation & ISP">
  <meta name="twitter:description" content="Find your public and local IP addresses, geolocation, ISP, ASN, and view location on a map. Privacy-first IP lookup tool.">
  <meta name="twitter:image" content="https://www.prabinpokhrel1.com.np/images/ip-finder-twitter.jpg">
  <meta name="twitter:creator" content="@prabinpokhrel">
  
  <!-- Favicon -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Leaflet CSS (loaded conditionally) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  
  <!-- Prism CSS (loaded conditionally) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" crossorigin=""/>
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "IP Finder Tool",
    "description": "Find your public and local IP addresses, geolocation, ISP, ASN, and view location on a map.",
    "url": "https://www.prabinpokhrel1.com.np/ip-finder.html",
    "applicationCategory": "UtilityApplication",
    "operatingSystem": "Any",
    "permissions": "none",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "author": {
      "@type": "Person",
      "name": "Prabin Pokhrel"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Prabin's Toolbox"
    }
  }
  </script>
     <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7081789084626782"
     crossorigin="anonymous"></script>
  
  <style>
    /* --------- RESET & VARIABLES --------- */
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      font-family: "Poppins", sans-serif; 
      transition: background-color 0.3s, color 0.3s;
    }

    :root {
      --primary: #38bdf8;
      --primary-dark: #0ea5e9;
      --secondary: #f472b6;
      --accent: #a78bfa;
      --bg: #0f172a;
      --bg-light: #1e293b;
      --bg-lighter: #334155;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --card-bg: rgba(255, 255, 255, 0.05);
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --border: rgba(255, 255, 255, 0.1);
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
    }

    .light-mode {
      --bg: #f8fafc;
      --bg-light: #e2e8f0;
      --bg-lighter: #cbd5e1;
      --text: #0f172a;
      --text-muted: #475569;
      --card-bg: rgba(255, 255, 255, 0.8);
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
      --border: rgba(0, 0, 0, 0.1);
    }

    body {
      background: linear-gradient(135deg, var(--bg), var(--bg-light));
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background 0.5s ease;
      padding: 0 1rem;
    }

    /* --------- HEADER & NAVIGATION --------- */
    header {
      width: 100%;
      padding: 1.5rem 1rem;
      text-align: center;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      position: relative;
      z-index: 100;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo i {
      font-size: 2.5rem;
      color: var(--primary);
      animation: rotate 10s linear infinite;
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .logo h1 {
      font-size: 2rem;
      color: var(--primary);
      letter-spacing: 1px;
    }

    .logo p {
      margin-top: 0.5rem;
      color: var(--text-muted);
      font-size: 1rem;
    }

    .theme-toggle {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 50px;
      width: 60px;
      height: 30px;
      position: relative;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 0 5px;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.05);
    }

    .theme-toggle i {
      position: absolute;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }

    .theme-toggle .fa-sun {
      color: #f59e0b;
      opacity: 0;
    }

    .theme-toggle .fa-moon {
      color: #94a3b8;
    }

    .light-mode .theme-toggle .fa-sun {
      opacity: 1;
    }

    .light-mode .theme-toggle .fa-moon {
      opacity: 0;
    }

    .theme-toggle::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary);
      transition: all 0.3s ease;
      left: 4px;
    }

    .light-mode .theme-toggle::after {
      left: calc(100% - 26px);
      background: #f59e0b;
    }

    /* --------- MAIN CONTENT --------- */
    main {
      max-width: 1200px;
      width: 100%;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .tool-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      margin-bottom: 2rem;
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .card-header h1 {
      font-size: 1.8rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .card-header p {
      color: var(--text-muted);
    }

    .card-header i {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    /* --------- PRIVACY NOTICE --------- */
    .privacy-notice {
      background: var(--bg-light);
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border);
      border-left: 4px solid var(--warning);
    }

    .privacy-notice h3 {
      color: var(--warning);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .privacy-notice p {
      color: var(--text-muted);
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* --------- ACTION BUTTONS --------- */
    .action-buttons {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 1rem 1.5rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      flex: 1;
      min-width: 200px;
    }

    .action-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
    }

    .action-btn:active {
      transform: translateY(0);
    }

    .action-btn.secondary {
      background: var(--bg-lighter);
      color: var(--text);
    }

    .action-btn.secondary:hover {
      background: var(--bg-light);
    }

    .action-btn.success {
      background: var(--success);
    }

    .action-btn.success:hover {
      background: #0da271;
    }

    .action-btn.warning {
      background: var(--warning);
      color: var(--text);
    }

    .action-btn.warning:hover {
      background: #e69008;
    }

    /* --------- CONSENT TOGGLE --------- */
    .consent-toggle {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
      padding: 1rem;
      background: var(--bg-light);
      border-radius: 10px;
      border: 1px solid var(--border);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--bg-lighter);
      transition: .4s;
      border-radius: 34px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--success);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(30px);
    }

    .toggle-label {
      color: var(--text);
      font-weight: 500;
    }

    /* --------- RESULT SECTIONS --------- */
    .result-section {
      background: var(--bg-light);
      border-radius: 10px;
      padding: 1.5rem;
      margin-top: 1.5rem;
      border: 1px solid var(--border);
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.5s ease;
    }

    .result-section.active {
      opacity: 1;
      transform: translateY(0);
      border-color: var(--success);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    }

    .result-section.error {
      border-color: var(--error);
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }

    .section-title {
      font-size: 1.2rem;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .copy-btn {
      padding: 0.5rem 1rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .copy-btn:hover {
      background: var(--primary-dark);
    }

    /* --------- IP DISPLAY --------- */
    .ip-display {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .ip-item {
      flex: 1;
      min-width: 200px;
      text-align: center;
      padding: 1rem;
      background: var(--card-bg);
      border-radius: 10px;
      border: 1px solid var(--border);
    }

    .ip-label {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    .ip-value {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary);
      word-break: break-all;
    }

    .ip-subvalue {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
    }

    /* --------- INFO GRID --------- */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      padding: 1rem;
      background: var(--card-bg);
      border-radius: 10px;
      border: 1px solid var(--border);
    }

    .info-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-value {
      font-size: 1rem;
      color: var(--text);
      font-weight: 500;
    }

    /* --------- MAP CONTAINER --------- */
    .map-container {
      height: 300px;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border);
    }

    .map-placeholder {
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--card-bg);
      color: var(--text-muted);
    }

    .map-placeholder i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    /* --------- JSON VIEWER --------- */
    .json-viewer {
      background: #1a1a1a;
      border-radius: 10px;
      padding: 1rem;
      overflow-x: auto;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid var(--border);
    }

    .json-viewer pre {
      margin: 0;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      color: #f8f8f2;
    }

    /* --------- HISTORY SECTION --------- */
    .history-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 1rem;
      background: var(--card-bg);
      border-radius: 8px;
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }

    .history-item:hover {
      background: var(--bg-lighter);
    }

    .history-info {
      display: flex;
      flex-direction: column;
    }

    .history-ip {
      font-weight: 600;
      color: var(--primary);
    }

    .history-time {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .history-actions {
      display: flex;
      gap: 0.5rem;
    }

    .history-btn {
      padding: 0.3rem 0.8rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .history-btn:hover {
      background: var(--primary-dark);
    }

    .history-btn.secondary {
      background: var(--bg-lighter);
      color: var(--text);
    }

    .history-btn.secondary:hover {
      background: var(--bg-light);
    }

    /* --------- TOAST MESSAGE --------- */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--success);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      box-shadow: var(--card-shadow);
      z-index: 1000;
      opacity: 0;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .toast.error {
      background: var(--error);
    }

    /* --------- CONTENT SECTIONS --------- */
    .content-section {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      margin-bottom: 2rem;
    }

    .content-section h2 {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .content-section h3 {
      font-size: 1.2rem;
      color: var(--secondary);
      margin: 1.5rem 0 0.5rem;
    }

    .content-section p {
      color: var(--text);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .content-section ul {
      padding-left: 1.5rem;
      margin-bottom: 1rem;
    }

    .content-section li {
      color: var(--text);
      line-height: 1.6;
      margin-bottom: 0.5rem;
    }

    .faq-item {
      margin-bottom: 1.5rem;
      border-bottom: 1px solid var(--border);
      padding-bottom: 1.5rem;
    }

    .faq-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .tool-links {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
    }

    .tool-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem 1.5rem;
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .tool-link:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-3px);
    }

    /* --------- BACK BUTTON --------- */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem 1.5rem;
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      margin-top: 1rem;
    }

    .back-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateX(-5px);
    }

    /* --------- FOOTER --------- */
    footer {
      padding: 2rem 1rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      width: 100%;
      margin-top: auto;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .footer-links {
      display: flex;
      gap: 2rem;
      margin-top: 1rem;
    }

    .footer-links a {
      color: var(--text-muted);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-links a:hover {
      color: var(--primary);
    }

    /* --------- RESPONSIVE DESIGN --------- */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
      }

      .action-buttons {
        flex-direction: column;
      }

      .action-btn {
        min-width: 100%;
      }

      .ip-display {
        flex-direction: column;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }
      
      .tool-links {
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .history-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .history-actions {
        width: 100%;
        justify-content: space-between;
      }
      
      .footer-links {
        flex-direction: column;
        gap: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        <i class="fas fa-toolbox" aria-hidden="true"></i>
        <div>
          <h1>All-in-One Tools</h1>
          <p>50+ useful tools for your everyday needs</p>
        </div>
      </div>
      <div class="theme-toggle" id="themeToggle" aria-label="Toggle dark/light mode" role="button" tabindex="0">
        <i class="fas fa-sun" aria-hidden="true"></i>
        <i class="fas fa-moon" aria-hidden="true"></i>
      </div>
    </div>
  </header>

  <main>
    <article>
      <div class="tool-card">
        <div class="card-header">
          <i class="fas fa-network-wired" aria-hidden="true"></i>
          <h1>IP Finder Tool</h1>
          <p>Discover your public and local IP addresses, geolocation, ISP, and network information</p>
        </div>

        <!-- Privacy Notice -->
        <div class="privacy-notice">
          <h3><i class="fas fa-shield-alt" aria-hidden="true"></i> Privacy Notice</h3>
          <p>This tool performs lookups on demand. Public IP/geolocation lookups require contacting a third-party API — your IP will be sent to that provider only when you click 'Get Geolocation'. History is stored locally in your browser and is not shared.</p>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="action-btn" id="detectPublicIp">
            <i class="fas fa-globe" aria-hidden="true"></i> Detect Public IP
          </button>
          <button class="action-btn secondary" id="detectLocalIp">
            <i class="fas fa-wifi" aria-hidden="true"></i> Detect Local IPs
          </button>
          <button class="action-btn success" id="clearAll">
            <i class="fas fa-broom" aria-hidden="true"></i> Clear All
          </button>
        </div>

        <!-- Consent Toggle -->
        <div class="consent-toggle">
          <label class="toggle-switch">
            <input type="checkbox" id="consentToggle">
            <span class="toggle-slider"></span>
          </label>
          <span class="toggle-label">I consent to sending my IP to third-party geolocation services</span>
        </div>

        <!-- Geolocation Button -->
        <button class="action-btn warning" id="getGeolocation" disabled>
          <i class="fas fa-map-marker-alt" aria-hidden="true"></i> Get Geolocation & ISP Info
        </button>

        <!-- Detected IPs Section -->
        <div class="result-section" id="ipSection">
          <div class="section-header">
            <h2 class="section-title"><i class="fas fa-laptop" aria-hidden="true"></i> Detected IP Addresses</h2>
            <button class="copy-btn" id="copyIp">
              <i class="fas fa-copy" aria-hidden="true"></i> Copy IPs
            </button>
          </div>
          <div class="ip-display">
            <div class="ip-item">
              <div class="ip-label">Public IPv4</div>
              <div class="ip-value" id="publicIpv4">-</div>
              <div class="ip-subvalue" id="ipType"></div>
            </div>
            <div class="ip-item">
              <div class="ip-label">Public IPv6</div>
              <div class="ip-value" id="publicIpv6">-</div>
              <div class="ip-subvalue">Not always available</div>
            </div>
            <div class="ip-item">
              <div class="ip-label">Local IPs</div>
              <div class="ip-value" id="localIps">-</div>
              <div class="ip-subvalue">Via WebRTC (browser-dependent)</div>
            </div>
          </div>
        </div>

        <!-- Geolocation & ISP Section -->
        <div class="result-section" id="geoSection">
          <div class="section-header">
            <h2 class="section-title"><i class="fas fa-map-marked-alt" aria-hidden="true"></i> Geolocation & ISP Information</h2>
            <button class="copy-btn" id="copyLocation">
              <i class="fas fa-copy" aria-hidden="true"></i> Copy Location
            </button>
          </div>
          <div class="info-grid" id="geoInfoGrid">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>

        <!-- Map Section -->
        <div class="result-section" id="mapSection">
          <div class="section-header">
            <h2 class="section-title"><i class="fas fa-map" aria-hidden="true"></i> Location Map</h2>
            <button class="copy-btn" id="shareLocation">
              <i class="fas fa-share-alt" aria-hidden="true"></i> Share Location
            </button>
          </div>
          <div class="map-container" id="mapContainer">
            <div class="map-placeholder">
              <i class="fas fa-map" aria-hidden="true"></i>
              <p>Map will appear here when location data is available</p>
            </div>
          </div>
        </div>

        <!-- Raw JSON Section -->
        <div class="result-section" id="jsonSection">
          <div class="section-header">
            <h2 class="section-title"><i class="fas fa-code" aria-hidden="true"></i> Raw API Response</h2>
            <button class="copy-btn" id="copyJson">
              <i class="fas fa-copy" aria-hidden="true"></i> Copy JSON
            </button>
          </div>
          <div class="json-viewer">
            <pre><code id="jsonOutput">No data available yet. Click "Get Geolocation" to fetch data.</code></pre>
          </div>
        </div>

        <!-- History Section -->
        <div class="result-section" id="historySection">
          <div class="section-header">
            <h2 class="section-title"><i class="fas fa-history" aria-hidden="true"></i> Lookup History</h2>
            <button class="copy-btn secondary" id="clearHistory">
              <i class="fas fa-trash" aria-hidden="true"></i> Clear History
            </button>
          </div>
          <div class="history-list" id="historyList">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>

        <a href="index.html" class="back-btn">
          <i class="fas fa-arrow-left" aria-hidden="true"></i> Back to Home
        </a>
      </div>
    </article>

    <section class="content-section">
      <h2><i class="fas fa-info-circle" aria-hidden="true"></i> About This IP Finder Tool</h2>
      <p>Our IP Finder is a comprehensive tool that helps you discover information about your network connection, including public and local IP addresses, geolocation data, ISP details, and more.</p>
      
      <h3>How It Works</h3>
      <p>This tool uses a combination of browser APIs and external services to gather information about your network:</p>
      <ul>
        <li><strong>Public IP Detection:</strong> Connects to external services to identify your public IP address</li>
        <li><strong>Local IP Detection:</strong> Uses WebRTC to discover local network addresses (limited by browser privacy settings)</li>
        <li><strong>Geolocation:</strong> Queries geolocation APIs to determine your approximate location based on IP</li>
        <li><strong>ISP Information:</strong> Retrieves details about your internet service provider and network</li>
      </ul>
      
      <h3>Privacy Considerations</h3>
      <p>We take your privacy seriously. This tool:</p>
      <ul>
        <li>Only contacts external APIs when you explicitly request geolocation data</li>
        <li>Stores lookup history locally in your browser (not on our servers)</li>
        <li>Does not track or store your IP address on our systems</li>
        <li>Provides clear consent controls for third-party API usage</li>
      </ul>
      
      <h3>Other Useful Tools</h3>
      <p>Explore more helpful utilities in our toolbox:</p>
      <div class="tool-links">
        <a href="age-calculator.html" class="tool-link" aria-label="Age Calculator">
          <i class="fas fa-birthday-cake" aria-hidden="true"></i> Age Calculator
        </a>
        <a href="base64-encoder-decoder.html" class="tool-link" aria-label="Base64 Encoder/Decoder">
          <i class="fas fa-code" aria-hidden="true"></i> Base64 Encoder/Decoder
        </a>
        <a href="unit-converter.html" class="tool-link" aria-label="Unit Converter">
          <i class="fas fa-ruler-combined" aria-hidden="true"></i> Unit Converter
        </a>
        <a href="index.html" class="tool-link" aria-label="All Tools">
          <i class="fas fa-tools" aria-hidden="true"></i> All Tools
        </a>
      </div>
    </section>

    <section class="content-section">
      <h2><i class="fas fa-question-circle" aria-hidden="true"></i> Frequently Asked Questions</h2>
      
      <div class="faq-item">
        <h3>Why can't I see my local IP address?</h3>
        <p>Many modern browsers restrict access to local IP addresses for privacy and security reasons. The WebRTC method used to detect local IPs may not work in all browsers or configurations.</p>
      </div>
      
      <div class="faq-item">
        <h3>How accurate is the geolocation data?</h3>
        <p>IP-based geolocation provides an approximate location, typically accurate to the city level. It's based on the registered location of your ISP and may not reflect your exact physical location.</p>
      </div>
      
      <div class="faq-item">
        <h3>Is my data being stored or shared?</h3>
        <p>No, your IP address and geolocation data are not stored on our servers. Lookup history is stored locally in your browser and can be cleared at any time. When using geolocation services, your IP is sent to the API provider according to their privacy policy.</p>
      </div>
      
      <div class="faq-item">
        <h3>Why do I need to consent to geolocation lookups?</h3>
        <p>Geolocation lookups require sending your IP address to a third-party API. We require explicit consent to ensure you're aware of this data sharing before proceeding.</p>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-content">
      <p>© 2025 Prabin's Toolbox | All Rights Reserved</p>
      <div class="footer-links">
        <a href="privacy-policy.html">Privacy Policy</a>
        <a href="terms-of-service.html">Terms of Service</a>
        <a href="contact.html">Contact Us</a>
      </div>
    </div>
  </footer>

  <!-- Toast Message -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle" aria-hidden="true"></i>
    <span id="toastMessage">Copied to clipboard!</span>
  </div>

  <script>
    // ========== CONFIGURATION ==========
    // Public IP APIs (no keys required)
    const PUBLIC_IP_API_PRIMARY = "https://api.ipify.org?format=json";
    const PUBLIC_IP_API_FALLBACK = "https://api64.ipify.org?format=json";
    
    // Geolocation API (no key required for basic usage)
    const GEO_API = "https://ipapi.co/{ip}/json/";
    // Alternative: https://ipinfo.io/{ip}/json?token=YOUR_TOKEN_HERE
    // const GEO_API_KEY = "YOUR_API_KEY_HERE"; // Uncomment and add your API key if using a service that requires one
    
    // DNS-over-HTTPS endpoint for reverse DNS lookup
    const DOH_API = "https://cloudflare-dns.com/dns-query?name={ip}&type=PTR";
    
    // History settings
    const MAX_HISTORY_ITEMS = 10;

    // ========== DOM ELEMENTS ==========
    const detectPublicIpBtn = document.getElementById('detectPublicIp');
    const detectLocalIpBtn = document.getElementById('detectLocalIp');
    const getGeolocationBtn = document.getElementById('getGeolocation');
    const clearAllBtn = document.getElementById('clearAll');
    const consentToggle = document.getElementById('consentToggle');
    
    const publicIpv4El = document.getElementById('publicIpv4');
    const publicIpv6El = document.getElementById('publicIpv6');
    const localIpsEl = document.getElementById('localIps');
    const ipTypeEl = document.getElementById('ipType');
    
    const ipSection = document.getElementById('ipSection');
    const geoSection = document.getElementById('geoSection');
    const mapSection = document.getElementById('mapSection');
    const jsonSection = document.getElementById('jsonSection');
    const historySection = document.getElementById('historySection');
    
    const geoInfoGrid = document.getElementById('geoInfoGrid');
    const mapContainer = document.getElementById('mapContainer');
    const jsonOutput = document.getElementById('jsonOutput');
    const historyList = document.getElementById('historyList');
    
    const copyIpBtn = document.getElementById('copyIp');
    const copyLocationBtn = document.getElementById('copyLocation');
    const copyJsonBtn = document.getElementById('copyJson');
    const shareLocationBtn = document.getElementById('shareLocation');
    const clearHistoryBtn = document.getElementById('clearHistory');
    
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');

    // ========== STATE VARIABLES ==========
    let currentPublicIp = null;
    let currentGeoData = null;
    let map = null;

    // ========== INITIALIZATION ==========
    function initializeTool() {
      // Load history on page load
      loadHistory();
      
      // Add event listeners
      detectPublicIpBtn.addEventListener('click', getPublicIp);
      detectLocalIpBtn.addEventListener('click', getLocalIps);
      getGeolocationBtn.addEventListener('click', getGeoInfo);
      clearAllBtn.addEventListener('click', clearAllData);
      
      copyIpBtn.addEventListener('click', copyIpToClipboard);
      copyLocationBtn.addEventListener('click', copyLocationToClipboard);
      copyJsonBtn.addEventListener('click', copyJsonToClipboard);
      shareLocationBtn.addEventListener('click', shareLocation);
      clearHistoryBtn.addEventListener('click', clearHistory);
      
      consentToggle.addEventListener('change', function() {
        getGeolocationBtn.disabled = !this.checked;
      });
      
      // Auto-detect public IP on page load
      getPublicIp();
    }

    // ========== PUBLIC IP DETECTION ==========
    async function getPublicIp() {
      try {
        showLoadingState(detectPublicIpBtn, 'Detecting...');
        
        // Try primary API first
        let response = await fetchWithTimeout(PUBLIC_IP_API_PRIMARY, { timeout: 5000 });
        
        if (!response.ok) {
          // Try fallback API
          response = await fetchWithTimeout(PUBLIC_IP_API_FALLBACK, { timeout: 5000 });
        }
        
        if (response.ok) {
          const data = await response.json();
          currentPublicIp = data.ip;
          
          // Determine IP type (IPv4 or IPv6)
          const isIPv6 = currentPublicIp.includes(':');
          
          if (isIPv6) {
            publicIpv6El.textContent = currentPublicIp;
            publicIpv4El.textContent = 'Not detected';
            ipTypeEl.textContent = 'IPv6 Address';
          } else {
            publicIpv4El.textContent = currentPublicIp;
            publicIpv6El.textContent = 'Not detected';
            ipTypeEl.textContent = 'IPv4 Address';
          }
          
          ipSection.classList.add('active');
          showToast('Public IP detected successfully');
          
          // Enable geolocation button if consent is given
          if (consentToggle.checked) {
            getGeolocationBtn.disabled = false;
          }
        } else {
          throw new Error('Failed to fetch public IP');
        }
      } catch (error) {
        console.error('Error detecting public IP:', error);
        showToast('Failed to detect public IP. Please try again.', 'error');
        publicIpv4El.textContent = 'Error';
        publicIpv6El.textContent = 'Error';
        ipTypeEl.textContent = 'Detection failed';
        ipSection.classList.add('active', 'error');
      } finally {
        resetButtonState(detectPublicIpBtn, 'Detect Public IP', 'fas fa-globe');
      }
    }

    // ========== LOCAL IP DETECTION ==========
    function getLocalIps() {
      try {
        showLoadingState(detectLocalIpBtn, 'Detecting...');
        
        // Use WebRTC to get local IPs
        const RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
        
        if (!RTCPeerConnection) {
          throw new Error('WebRTC not supported by this browser');
        }
        
        const pc = new RTCPeerConnection({ iceServers: [] });
        const localIps = [];
        
        // Listen for candidate events
        pc.onicecandidate = (event) => {
          if (!event.candidate) {
            // All candidates have been gathered
            if (localIps.length === 0) {
              localIpsEl.textContent = 'Not available (browser restrictions)';
            } else {
              localIpsEl.textContent = localIps.join(', ');
            }
            ipSection.classList.add('active');
            resetButtonState(detectLocalIpBtn, 'Detect Local IPs', 'fas fa-wifi');
            return;
          }
          
          const candidate = event.candidate.candidate;
          const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/;
          const match = candidate.match(ipRegex);
          
          if (match) {
            const ip = match[1];
            // Filter out duplicate and non-private IPs
            if (!localIps.includes(ip) && isPrivateIp(ip)) {
              localIps.push(ip);
            }
          }
        };
        
        // Create a data channel to trigger candidate gathering
        pc.createDataChannel('');
        
        // Create an offer to trigger candidate gathering
        pc.createOffer()
          .then(offer => pc.setLocalDescription(offer))
          .catch(error => {
            console.error('Error creating offer:', error);
            localIpsEl.textContent = 'Not available (browser restrictions)';
            ipSection.classList.add('active');
            resetButtonState(detectLocalIpBtn, 'Detect Local IPs', 'fas fa-wifi');
          });
          
        // Set a timeout in case candidate gathering takes too long
        setTimeout(() => {
          if (localIps.length === 0) {
            localIpsEl.textContent = 'Not available (browser restrictions)';
            ipSection.classList.add('active');
            resetButtonState(detectLocalIpBtn, 'Detect Local IPs', 'fas fa-wifi');
          }
        }, 3000);
        
      } catch (error) {
        console.error('Error detecting local IPs:', error);
        localIpsEl.textContent = 'Not available (browser restrictions)';
        ipSection.classList.add('active');
        resetButtonState(detectLocalIpBtn, 'Detect Local IPs', 'fas fa-wifi');
        showToast('Local IP detection limited by browser privacy settings', 'error');
      }
    }

    // ========== GEOLOCATION & ISP INFO ==========
    async function getGeoInfo() {
      if (!currentPublicIp) {
        showToast('Please detect your public IP first', 'error');
        return;
      }
      
      if (!consentToggle.checked) {
        showToast('Please consent to geolocation lookup first', 'error');
        return;
      }
      
      try {
        showLoadingState(getGeolocationBtn, 'Fetching...');
        
        // Replace {ip} placeholder with actual IP
        const apiUrl = GEO_API.replace('{ip}', currentPublicIp);
        
        const response = await fetchWithTimeout(apiUrl, { timeout: 10000 });
        
        if (!response.ok) {
          throw new Error(`API returned ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        currentGeoData = data;
        
        // Display geolocation information
        displayGeoInfo(data);
        
        // Show map if coordinates are available
        if (data.latitude && data.longitude) {
          showMap(data.latitude, data.longitude, data);
        }
        
        // Display raw JSON
        displayJson(data);
        
        // Save to history
        saveToHistory(data);
        
        showToast('Geolocation data fetched successfully');
        
      } catch (error) {
        console.error('Error fetching geolocation data:', error);
        showToast('Failed to fetch geolocation data. Please try again.', 'error');
        geoSection.classList.add('error');
      } finally {
        resetButtonState(getGeolocationBtn, 'Get Geolocation & ISP Info', 'fas fa-map-marker-alt');
      }
    }

    // ========== DISPLAY FUNCTIONS ==========
    function displayGeoInfo(data) {
      // Clear previous content
      geoInfoGrid.innerHTML = '';
      
      // Define which fields to display
      const fields = [
        { label: 'Country', key: 'country_name', icon: 'fas fa-flag' },
        { label: 'Region/State', key: 'region', icon: 'fas fa-map' },
        { label: 'City', key: 'city', icon: 'fas fa-city' },
        { label: 'Postal Code', key: 'postal', icon: 'fas fa-envelope' },
        { label: 'ISP', key: 'org', icon: 'fas fa-network-wired' },
        { label: 'ASN', key: 'asn', icon: 'fas fa-sitemap' },
        { label: 'Timezone', key: 'timezone', icon: 'fas fa-clock' },
        { label: 'Coordinates', key: 'coordinates', icon: 'fas fa-location-dot' }
      ];
      
      // Create info items for each field
      fields.forEach(field => {
        const item = document.createElement('div');
        item.className = 'info-item';
        
        let value = 'Not available';
        
        if (field.key === 'coordinates') {
          if (data.latitude && data.longitude) {
            value = `${data.latitude}, ${data.longitude}`;
          }
        } else if (data[field.key]) {
          value = data[field.key];
        }
        
        item.innerHTML = `
          <div class="info-label">${field.label}</div>
          <div class="info-value">
            <i class="${field.icon}" aria-hidden="true"></i>
            ${value}
          </div>
        `;
        
        geoInfoGrid.appendChild(item);
      });
      
      // Show the section
      geoSection.classList.add('active');
    }

    function showMap(lat, lon, data) {
      // Check if Leaflet is available
      if (typeof L === 'undefined') {
        // Load Leaflet dynamically
        loadLeaflet().then(() => {
          initMap(lat, lon, data);
        });
      } else {
        initMap(lat, lon, data);
      }
    }

    function initMap(lat, lon, data) {
      // Clear previous map
      if (map) {
        map.remove();
      }
      
      // Initialize map
      map = L.map(mapContainer).setView([lat, lon], 10);
      
      // Add tile layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
      
      // Add marker
      const marker = L.marker([lat, lon]).addTo(map);
      
      // Create popup content
      let popupContent = `<b>Approximate Location</b><br>`;
      if (data.city) popupContent += `City: ${data.city}<br>`;
      if (data.region) popupContent += `Region: ${data.region}<br>`;
      if (data.country_name) popupContent += `Country: ${data.country_name}<br>`;
      if (currentPublicIp) popupContent += `IP: ${currentPublicIp}`;
      
      marker.bindPopup(popupContent).openPopup();
      
      // Show the section
      mapSection.classList.add('active');
    }

    function displayJson(data) {
      // Check if Prism is available for syntax highlighting
      if (typeof Prism !== 'undefined') {
        jsonOutput.textContent = JSON.stringify(data, null, 2);
        Prism.highlightElement(jsonOutput);
      } else {
        // Load Prism dynamically
        loadPrism().then(() => {
          jsonOutput.textContent = JSON.stringify(data, null, 2);
          Prism.highlightElement(jsonOutput);
        });
      }
      
      // Show the section
      jsonSection.classList.add('active');
    }

    // ========== COPY FUNCTIONS ==========
    function copyIpToClipboard() {
      const ipText = `Public IPv4: ${publicIpv4El.textContent}\nPublic IPv6: ${publicIpv6El.textContent}\nLocal IPs: ${localIpsEl.textContent}`;
      copyTextToClipboard(ipText, 'IP addresses copied to clipboard');
    }

    function copyLocationToClipboard() {
      if (!currentGeoData) {
        showToast('No location data available to copy', 'error');
        return;
      }
      
      let locationText = '';
      if (currentGeoData.city) locationText += `${currentGeoData.city}, `;
      if (currentGeoData.region) locationText += `${currentGeoData.region}, `;
      if (currentGeoData.country_name) locationText += `${currentGeoData.country_name}`;
      if (currentGeoData.org) locationText += ` | ISP: ${currentGeoData.org}`;
      
      copyTextToClipboard(locationText, 'Location information copied to clipboard');
    }

    function copyJsonToClipboard() {
      if (!currentGeoData) {
        showToast('No JSON data available to copy', 'error');
        return;
      }
      
      const jsonText = JSON.stringify(currentGeoData, null, 2);
      copyTextToClipboard(jsonText, 'JSON data copied to clipboard');
    }

    function shareLocation() {
      if (!currentGeoData) {
        showToast('No location data available to share', 'error');
        return;
      }
      
      let shareText = '';
      if (currentGeoData.city && currentGeoData.country_name) {
        shareText = `My approximate location: ${currentGeoData.city}, ${currentGeoData.country_name}`;
      } else if (currentGeoData.country_name) {
        shareText = `My approximate country: ${currentGeoData.country_name}`;
      } else {
        shareText = 'Location information not available';
      }
      
      copyTextToClipboard(shareText, 'Location summary copied to clipboard');
    }

    // ========== HISTORY FUNCTIONS ==========
    function saveToHistory(data) {
      const history = loadHistory();
      
      // Create history entry
      const entry = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        ip: currentPublicIp,
        city: data.city || 'Unknown',
        country: data.country_name || 'Unknown',
        isp: data.org || 'Unknown'
      };
      
      // Add to beginning of array
      history.unshift(entry);
      
      // Keep only the last MAX_HISTORY_ITEMS entries
      if (history.length > MAX_HISTORY_ITEMS) {
        history.splice(MAX_HISTORY_ITEMS);
      }
      
      // Save to localStorage
      localStorage.setItem('ipFinderHistory', JSON.stringify(history));
      
      // Update UI
      loadHistory();
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('ipFinderHistory') || '[]');
      
      // Update UI
      historyList.innerHTML = '';
      
      if (history.length === 0) {
        historyList.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No lookup history yet</p>';
        return history;
      }
      
      history.forEach(entry => {
        const item = document.createElement('div');
        item.className = 'history-item';
        
        const date = new Date(entry.timestamp);
        const timeString = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        item.innerHTML = `
          <div class="history-info">
            <div class="history-ip">${entry.ip}</div>
            <div class="history-time">${entry.city}, ${entry.country} • ${timeString}</div>
          </div>
          <div class="history-actions">
            <button class="history-btn" data-action="recall" data-ip="${entry.ip}">Recall</button>
            <button class="history-btn secondary" data-action="delete" data-id="${entry.id}">Delete</button>
          </div>
        `;
        
        historyList.appendChild(item);
      });
      
      // Add event listeners to history buttons
      document.querySelectorAll('[data-action="recall"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const ip = this.getAttribute('data-ip');
          recallHistoryItem(ip);
        });
      });
      
      document.querySelectorAll('[data-action="delete"]').forEach(btn => {
        btn.addEventListener('click', function() {
          const id = parseInt(this.getAttribute('data-id'));
          deleteHistoryItem(id);
        });
      });
      
      // Show the section
      historySection.classList.add('active');
      
      return history;
    }

    function recallHistoryItem(ip) {
      currentPublicIp = ip;
      publicIpv4El.textContent = ip;
      publicIpv6El.textContent = 'Not detected';
      ipTypeEl.textContent = 'From history';
      ipSection.classList.add('active');
      
      showToast('IP recalled from history');
      
      // Enable geolocation if consent is given
      if (consentToggle.checked) {
        getGeolocationBtn.disabled = false;
      }
    }

    function deleteHistoryItem(id) {
      const history = loadHistory();
      const updatedHistory = history.filter(entry => entry.id !== id);
      
      localStorage.setItem('ipFinderHistory', JSON.stringify(updatedHistory));
      loadHistory();
      
      showToast('History item deleted');
    }

    function clearHistory() {
      localStorage.removeItem('ipFinderHistory');
      loadHistory();
      showToast('History cleared');
    }

    // ========== UTILITY FUNCTIONS ==========
    function fetchWithTimeout(url, options = {}) {
      const { timeout = 8000 } = options;
      
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), timeout);
      
      return fetch(url, {
        ...options,
        signal: controller.signal
      }).finally(() => clearTimeout(timeoutId));
    }

    function copyTextToClipboard(text, message) {
      navigator.clipboard.writeText(text).then(() => {
        showToast(message);
      }).catch(err => {
        console.error('Failed to copy text: ', err);
        showToast('Failed to copy to clipboard', 'error');
      });
    }

    function showLoadingState(button, text) {
      button.innerHTML = `<i class="fas fa-spinner fa-spin" aria-hidden="true"></i> ${text}`;
      button.disabled = true;
    }

    function resetButtonState(button, text, icon) {
      button.innerHTML = `<i class="${icon}" aria-hidden="true"></i> ${text}`;
      button.disabled = false;
    }

    function showToast(message, type = 'success') {
      toastMessage.textContent = message;
      
      // Update toast style based on type
      if (type === 'error') {
        toast.className = 'toast error';
      } else {
        toast.className = 'toast';
      }
      
      // Show toast
      toast.classList.add('show');
      
      // Hide after 3 seconds
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function clearAllData() {
      // Reset IP display
      publicIpv4El.textContent = '-';
      publicIpv6El.textContent = '-';
      localIpsEl.textContent = '-';
      ipTypeEl.textContent = '';
      
      // Reset sections
      ipSection.classList.remove('active', 'error');
      geoSection.classList.remove('active', 'error');
      mapSection.classList.remove('active', 'error');
      jsonSection.classList.remove('active', 'error');
      
      // Clear map
      if (map) {
        map.remove();
        map = null;
      }
      
      // Clear JSON
      jsonOutput.textContent = 'No data available yet. Click "Get Geolocation" to fetch data.';
      
      // Clear geo info grid
      geoInfoGrid.innerHTML = '';
      
      // Reset map container
      mapContainer.innerHTML = `
        <div class="map-placeholder">
          <i class="fas fa-map" aria-hidden="true"></i>
          <p>Map will appear here when location data is available</p>
        </div>
      `;
      
      // Reset state
      currentPublicIp = null;
      currentGeoData = null;
      
      showToast('All data cleared');
    }

    function isPrivateIp(ip) {
      // Check if IP is in private ranges
      const privateRanges = [
        /^10\./,
        /^172\.(1[6-9]|2[0-9]|3[0-1])\./,
        /^192\.168\./,
        /^127\./,
        /^169\.254\./,
        /^fc00:/,
        /^fe80:/
      ];
      
      return privateRanges.some(regex => regex.test(ip));
    }

    function loadLeaflet() {
      return new Promise((resolve, reject) => {
        if (typeof L !== 'undefined') {
          resolve();
          return;
        }
        
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
        script.crossOrigin = '';
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    function loadPrism() {
      return new Promise((resolve, reject) => {
        if (typeof Prism !== 'undefined') {
          resolve();
          return;
        }
        
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js';
        script.crossOrigin = '';
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    // ========== THEME TOGGLE ==========
    const themeToggle = document.getElementById("themeToggle");
    const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
    
    // Check for saved theme preference or use device preference
    const currentTheme = localStorage.getItem("theme") || 
                        (prefersDarkScheme.matches ? "dark" : "light");
    
    if (currentTheme === "light") {
      document.body.classList.add("light-mode");
    }
    
    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("light-mode");
      
      // Save theme preference
      const theme = document.body.classList.contains("light-mode") ? "light" : "dark";
      localStorage.setItem("theme", theme);
    });
    
    themeToggle.addEventListener("keypress", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        document.body.classList.toggle("light-mode");
        
        // Save theme preference
        const theme = document.body.classList.contains("light-mode") ? "light" : "dark";
        localStorage.setItem("theme", theme);
      }
    });

    // Initialize the tool when the page loads
    document.addEventListener('DOMContentLoaded', initializeTool);
  </script>
</body>
</html>
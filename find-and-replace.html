<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find & Replace</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7081789084626782"
     crossorigin="anonymous"></script>
  <style>
    /* --------- RESET & VARIABLES --------- */
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      font-family: "Poppins", sans-serif; 
      transition: background-color 0.3s, color 0.3s;
    }

    :root {
      --primary: #38bdf8;
      --primary-dark: #0ea5e9;
      --secondary: #f472b6;
      --accent: #a78bfa;
      --bg: #0f172a;
      --bg-light: #1e293b;
      --bg-lighter: #334155;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --card-bg: rgba(255, 255, 255, 0.05);
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --border: rgba(255, 255, 255, 0.1);
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
      --highlight: rgba(56, 189, 248, 0.3);
      --current-highlight: rgba(244, 114, 182, 0.4);
    }

    .light-mode {
      --bg: #f8fafc;
      --bg-light: #e2e8f0;
      --bg-lighter: #cbd5e1;
      --text: #0f172a;
      --text-muted: #475569;
      --card-bg: rgba(255, 255, 255, 0.8);
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
      --border: rgba(0, 0, 0, 0.1);
      --highlight: rgba(56, 189, 248, 0.2);
      --current-highlight: rgba(244, 114, 182, 0.3);
    }

    body {
      background: linear-gradient(135deg, var(--bg), var(--bg-light));
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background 0.5s ease;
      padding: 0 1rem;
    }

    /* --------- HEADER & NAVIGATION --------- */
    header {
      width: 100%;
      padding: 1.5rem 1rem;
      text-align: center;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      position: relative;
      z-index: 100;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo i {
      font-size: 2.5rem;
      color: var(--primary);
      animation: rotate 10s linear infinite;
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .logo h1 {
      font-size: 2rem;
      color: var(--primary);
      letter-spacing: 1px;
    }

    .logo p {
      margin-top: 0.5rem;
      color: var(--text-muted);
      font-size: 1rem;
    }

    .theme-toggle {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 50px;
      width: 60px;
      height: 30px;
      position: relative;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 0 5px;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.05);
    }

    .theme-toggle i {
      position: absolute;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }

    .theme-toggle .fa-sun {
      color: #f59e0b;
      opacity: 0;
    }

    .theme-toggle .fa-moon {
      color: #94a3b8;
    }

    .light-mode .theme-toggle .fa-sun {
      opacity: 1;
    }

    .light-mode .theme-toggle .fa-moon {
      opacity: 0;
    }

    .theme-toggle::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary);
      transition: all 0.3s ease;
      left: 4px;
    }

    .light-mode .theme-toggle::after {
      left: calc(100% - 26px);
      background: #f59e0b;
    }

    /* --------- MAIN CONTENT --------- */
    .main-content {
      max-width: 1200px;
      width: 100%;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .tool-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      margin-bottom: 2rem;
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .card-header h2 {
      font-size: 1.8rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .card-header p {
      color: var(--text-muted);
    }

    .card-header i {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    /* --------- TEXT AREA CONTAINER --------- */
    .text-container {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .text-area-group {
      display: flex;
      flex-direction: column;
    }

    .text-area-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text);
    }

    .text-input {
      width: 100%;
      min-height: 200px;
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 10px;
      outline: none;
      font-size: 1rem;
      background: var(--bg-light);
      color: var(--text);
      transition: all 0.3s ease;
      border: 1px solid var(--border);
      resize: vertical;
      font-family: monospace;
      line-height: 1.5;
      position: relative;
      z-index: 2;
    }

    .text-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
    }

    .highlight-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      pointer-events: none;
      z-index: 1;
      font-family: monospace;
      line-height: 1.5;
      white-space: pre-wrap;
      word-wrap: break-word;
      color: transparent;
    }

    .highlight {
      background-color: var(--highlight);
      border-radius: 3px;
    }

    .current-highlight {
      background-color: var(--current-highlight);
      border-radius: 3px;
      box-shadow: 0 0 0 2px var(--secondary);
    }

    /* --------- FIND & REPLACE CONTROLS --------- */
    .controls-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    @media (max-width: 768px) {
      .controls-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text);
    }

    .form-control {
      width: 100%;
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 10px;
      outline: none;
      font-size: 1rem;
      background: var(--bg-light);
      color: var(--text);
      transition: all 0.3s ease;
      border: 1px solid var(--border);
    }

    .form-control:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
    }

    .input-with-icon {
      position: relative;
    }

    .input-with-icon i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }

    .input-with-icon input {
      padding-left: 3rem;
    }

    /* --------- OPTIONS SECTION --------- */
    .options-section {
      background: var(--bg-light);
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border);
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .option-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      border-radius: 8px;
      background: var(--card-bg);
      transition: all 0.3s ease;
    }

    .option-item:hover {
      background: var(--bg-lighter);
      transform: translateY(-2px);
    }

    .option-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--primary);
    }

    .option-item label {
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
    }

    .option-description {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    .toggle-group {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    .toggle-label {
      font-weight: 500;
      color: var(--text);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--bg-lighter);
      transition: .4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--primary);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    /* --------- BUTTONS --------- */
    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .btn {
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #0da271;
      transform: translateY(-3px);
    }

    .btn-warning {
      background: var(--warning);
      color: white;
    }

    .btn-warning:hover {
      background: #d97706;
      transform: translateY(-3px);
    }

    .btn-secondary {
      background: var(--bg-lighter);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-light);
      transform: translateY(-3px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* --------- PREVIEW SECTION --------- */
    .preview-section {
      background: var(--bg-light);
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border);
      display: none;
    }

    .preview-section.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .preview-title {
      font-size: 1.2rem;
      color: var(--primary);
      font-weight: 600;
    }

    .preview-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    @media (max-width: 768px) {
      .preview-container {
        grid-template-columns: 1fr;
      }
    }

    .preview-pane {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 1rem;
      border: 1px solid var(--border);
    }

    .preview-label {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .preview-content {
      font-family: monospace;
      line-height: 1.5;
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 300px;
      overflow-y: auto;
      padding: 0.5rem;
      background: var(--bg-lighter);
      border-radius: 5px;
    }

    .replacement {
      background-color: var(--success);
      color: white;
      padding: 0 2px;
      border-radius: 3px;
    }

    /* --------- MATCH INFO --------- */
    .match-info {
      background: var(--bg-light);
      border-radius: 10px;
      padding: 1rem 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .match-count {
      font-weight: 600;
      color: var(--primary);
    }

    .match-navigation {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .nav-btn {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 5px;
      padding: 0.5rem 1rem;
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-btn:hover {
      background: var(--primary);
      color: white;
    }

    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* --------- STATUS MESSAGES --------- */
    .status-message {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
    }

    .status-message.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .status-success {
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid var(--success);
      color: var(--success);
    }

    .status-error {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid var(--error);
      color: var(--error);
    }

    .status-info {
      background: rgba(56, 189, 248, 0.2);
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    /* --------- BACK BUTTON --------- */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem 1.5rem;
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      margin-top: 1rem;
    }

    .back-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateX(-5px);
    }

    /* --------- MESSAGE TOAST --------- */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      background: var(--success);
      color: white;
      border-radius: 10px;
      box-shadow: var(--card-shadow);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* --------- FOOTER --------- */
    footer {
      padding: 2rem 1rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      width: 100%;
      margin-top: auto;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .footer-links {
      display: flex;
      gap: 2rem;
      margin-top: 1rem;
    }

    .footer-links a {
      color: var(--text-muted);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-links a:hover {
      color: var(--primary);
    }

    /* --------- RESPONSIVE DESIGN --------- */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
      }

      .button-grid {
        grid-template-columns: 1fr;
      }

      .options-grid {
        grid-template-columns: 1fr;
      }

      .match-info {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }
    }

    @media (max-width: 480px) {
      .tool-card {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        <i class="fas fa-toolbox"></i>
        <div>
          <h1>All-in-One Tools</h1>
          <p>50+ useful tools for your everyday needs</p>
        </div>
      </div>
      <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-sun"></i>
        <i class="fas fa-moon"></i>
      </div>
    </div>
  </header>

  <div class="main-content">
    <div class="tool-card">
      <div class="card-header">
        <i class="fas fa-search-plus"></i>
        <h2>Find & Replace</h2>
        <p>Search and replace text with advanced options and live preview</p>
      </div>

      <div class="status-message" id="statusMessage"></div>

      <div class="text-container">
        <div class="text-area-group">
          <label for="inputText">Text to Search <span class="required">*</span></label>
          <textarea 
            id="inputText" 
            class="text-input" 
            placeholder="Enter or paste your text here..."
            autofocus
          ></textarea>
          <div class="highlight-overlay" id="highlightOverlay"></div>
        </div>
      </div>

      <div class="controls-grid">
        <div class="form-group">
          <label for="findText">Find <span class="required">*</span></label>
          <div class="input-with-icon">
            <i class="fas fa-search"></i>
            <input type="text" id="findText" class="form-control" placeholder="Text to find...">
          </div>
        </div>

        <div class="form-group">
          <label for="replaceText">Replace With</label>
          <div class="input-with-icon">
            <i class="fas fa-exchange-alt"></i>
            <input type="text" id="replaceText" class="form-control" placeholder="Replacement text...">
          </div>
        </div>
      </div>

      <div class="options-section">
        <h3 style="margin-bottom: 1rem; color: var(--primary);">Search Options</h3>
        <div class="options-grid">
          <div class="option-item">
            <input type="checkbox" id="caseSensitive">
            <div>
              <label for="caseSensitive">Case Sensitive</label>
              <div class="option-description">Match exact letter casing</div>
            </div>
          </div>
          <div class="option-item">
            <input type="checkbox" id="wholeWord">
            <div>
              <label for="wholeWord">Whole Word Only</label>
              <div class="option-description">Match complete words only</div>
            </div>
          </div>
          <div class="option-item">
            <input type="checkbox" id="useRegex">
            <div>
              <label for="useRegex">Use Regular Expression</label>
              <div class="option-description">Treat find text as regex pattern</div>
            </div>
          </div>
        </div>

        <div class="toggle-group">
          <div class="toggle-switch">
            <input type="checkbox" id="livePreview">
            <span class="toggle-slider"></span>
          </div>
          <label for="livePreview" class="toggle-label">Live Preview (show changes as you type)</label>
        </div>
      </div>

      <div class="match-info" id="matchInfo" style="display: none;">
        <div class="match-count" id="matchCount">0 matches found</div>
        <div class="match-navigation">
          <button class="nav-btn" id="prevMatch">
            <i class="fas fa-chevron-left"></i> Previous
          </button>
          <span id="currentMatch">0 of 0</span>
          <button class="nav-btn" id="nextMatch">
            Next <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>

      <div class="button-grid">
        <button class="btn btn-primary" id="findBtn">
          <i class="fas fa-search"></i> Find All
        </button>
        <button class="btn btn-secondary" id="replaceBtn" disabled>
          <i class="fas fa-exchange-alt"></i> Replace
        </button>
        <button class="btn btn-warning" id="replaceAllBtn" disabled>
          <i class="fas fa-sync-alt"></i> Replace All
        </button>
        <button class="btn btn-secondary" id="previewBtn">
          <i class="fas fa-eye"></i> Preview Changes
        </button>
        <button class="btn btn-success" id="applyPreviewBtn" disabled>
          <i class="fas fa-check"></i> Apply Preview
        </button>
        <button class="btn btn-success" id="copyBtn" disabled>
          <i class="fas fa-copy"></i> Copy Result
        </button>
        <button class="btn btn-secondary" id="resetBtn">
          <i class="fas fa-redo"></i> Reset All
        </button>
      </div>

      <div class="preview-section" id="previewSection">
        <div class="preview-header">
          <div class="preview-title">Preview Changes</div>
          <button class="nav-btn" id="closePreview">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
        <div class="preview-container">
          <div class="preview-pane">
            <div class="preview-label">Original Text</div>
            <div class="preview-content" id="originalPreview"></div>
          </div>
          <div class="preview-pane">
            <div class="preview-label">Modified Text</div>
            <div class="preview-content" id="modifiedPreview"></div>
          </div>
        </div>
      </div>

      <a href="index.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> Back to Home
      </a>
    </div>
  </div>

  <footer>
    <div class="footer-content">
      <p>© 2025 Prabin's Toolbox | All Rights Reserved</p>
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
        <a href="#">Contact Us</a>
      </div>
    </div>
  </footer>

  <div class="toast" id="copyToast">
    <i class="fas fa-check-circle"></i>
    <span>Text copied to clipboard!</span>
  </div>

  <script>
    // ---------- DOM ELEMENTS ----------
    const inputText = document.getElementById('inputText');
    const findText = document.getElementById('findText');
    const replaceText = document.getElementById('replaceText');
    const highlightOverlay = document.getElementById('highlightOverlay');
    const matchInfo = document.getElementById('matchInfo');
    const matchCount = document.getElementById('matchCount');
    const currentMatch = document.getElementById('currentMatch');
    const prevMatch = document.getElementById('prevMatch');
    const nextMatch = document.getElementById('nextMatch');
    const statusMessage = document.getElementById('statusMessage');
    
    // Buttons
    const findBtn = document.getElementById('findBtn');
    const replaceBtn = document.getElementById('replaceBtn');
    const replaceAllBtn = document.getElementById('replaceAllBtn');
    const previewBtn = document.getElementById('previewBtn');
    const applyPreviewBtn = document.getElementById('applyPreviewBtn');
    const copyBtn = document.getElementById('copyBtn');
    const resetBtn = document.getElementById('resetBtn');
    const closePreview = document.getElementById('closePreview');
    
    // Options
    const caseSensitive = document.getElementById('caseSensitive');
    const wholeWord = document.getElementById('wholeWord');
    const useRegex = document.getElementById('useRegex');
    const livePreview = document.getElementById('livePreview');
    
    // Preview elements
    const previewSection = document.getElementById('previewSection');
    const originalPreview = document.getElementById('originalPreview');
    const modifiedPreview = document.getElementById('modifiedPreview');
    
    // Toast
    const copyToast = document.getElementById('copyToast');

    // ---------- STATE VARIABLES ----------
    let matches = [];
    let currentMatchIndex = -1;
    let previewResult = '';

    // ---------- INITIALIZATION ----------
    function initializeTool() {
      // Add event listeners
      inputText.addEventListener('input', handleInputChange);
      findText.addEventListener('input', handleFindChange);
      replaceText.addEventListener('input', handleFindChange);
      
      // Button event listeners
      findBtn.addEventListener('click', findAllMatches);
      replaceBtn.addEventListener('click', replaceCurrent);
      replaceAllBtn.addEventListener('click', replaceAll);
      previewBtn.addEventListener('click', showPreview);
      applyPreviewBtn.addEventListener('click', applyPreview);
      copyBtn.addEventListener('click', copyResult);
      resetBtn.addEventListener('click', resetAll);
      closePreview.addEventListener('click', hidePreview);
      
      // Navigation buttons
      prevMatch.addEventListener('click', navigateToPrevMatch);
      nextMatch.addEventListener('click', navigateToNextMatch);
      
      // Option change listeners
      caseSensitive.addEventListener('change', handleOptionChange);
      wholeWord.addEventListener('change', handleOptionChange);
      useRegex.addEventListener('change', handleOptionChange);
      livePreview.addEventListener('change', handleOptionChange);
      
      // Set initial state
      updateButtonStates();
    }

    // ---------- EVENT HANDLERS ----------
    function handleInputChange() {
      if (livePreview.checked) {
        findAllMatches();
      }
    }

    function handleFindChange() {
      if (livePreview.checked) {
        findAllMatches();
      }
    }

    function handleOptionChange() {
      if (livePreview.checked) {
        findAllMatches();
      }
    }

    // ---------- FIND & MATCH FUNCTIONS ----------
    function findAllMatches() {
      const text = inputText.value;
      const find = findText.value;
      
      if (!text || !find) {
        clearMatches();
        updateButtonStates();
        return;
      }
      
      try {
        matches = findMatches(text, find);
        updateMatchInfo();
        highlightMatches();
        updateButtonStates();
        
        if (matches.length > 0) {
          navigateToMatch(0);
          showStatus(`${matches.length} match${matches.length !== 1 ? 'es' : ''} found`, 'success');
        } else {
          showStatus('No matches found', 'info');
        }
      } catch (error) {
        showStatus(`Invalid regex pattern: ${error.message}`, 'error');
        clearMatches();
      }
    }

    function findMatches(text, find) {
      if (!find) return [];
      
      let flags = 'g';
      if (!caseSensitive.checked) flags += 'i';
      
      let pattern = find;
      
      if (useRegex.checked) {
        // Use the find text as a regex pattern
        try {
          new RegExp(pattern, flags); // Test if pattern is valid
        } catch (e) {
          throw new Error('Invalid regular expression');
        }
      } else {
        // Escape regex special characters for literal search
        pattern = find.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        
        if (wholeWord.checked) {
          pattern = `\\b${pattern}\\b`;
        }
      }
      
      const regex = new RegExp(pattern, flags);
      const matches = [];
      let match;
      
      while ((match = regex.exec(text)) !== null) {
        matches.push({
          start: match.index,
          end: match.index + match[0].length,
          text: match[0]
        });
        
        // Avoid infinite loops with zero-length matches
        if (match.index === regex.lastIndex) {
          regex.lastIndex++;
        }
      }
      
      return matches;
    }

    function highlightMatches() {
      const text = inputText.value;
      if (!text) {
        highlightOverlay.innerHTML = '';
        return;
      }
      
      let highlightedText = '';
      let lastIndex = 0;
      
      matches.forEach((match, index) => {
        // Add text before match
        highlightedText += escapeHtml(text.substring(lastIndex, match.start));
        
        // Add highlighted match
        const highlightClass = index === currentMatchIndex ? 'current-highlight' : 'highlight';
        highlightedText += `<span class="${highlightClass}">${escapeHtml(text.substring(match.start, match.end))}</span>`;
        
        lastIndex = match.end;
      });
      
      // Add remaining text
      highlightedText += escapeHtml(text.substring(lastIndex));
      
      highlightOverlay.innerHTML = highlightedText;
    }

    function clearMatches() {
      matches = [];
      currentMatchIndex = -1;
      matchInfo.style.display = 'none';
      highlightOverlay.innerHTML = escapeHtml(inputText.value || '');
      updateButtonStates();
    }

    // ---------- NAVIGATION FUNCTIONS ----------
    function navigateToMatch(index) {
      if (matches.length === 0 || index < 0 || index >= matches.length) return;
      
      currentMatchIndex = index;
      updateMatchInfo();
      highlightMatches();
      scrollToCurrentMatch();
    }

    function navigateToPrevMatch() {
      if (matches.length === 0) return;
      
      let newIndex = currentMatchIndex - 1;
      if (newIndex < 0) newIndex = matches.length - 1;
      
      navigateToMatch(newIndex);
    }

    function navigateToNextMatch() {
      if (matches.length === 0) return;
      
      let newIndex = currentMatchIndex + 1;
      if (newIndex >= matches.length) newIndex = 0;
      
      navigateToMatch(newIndex);
    }

    function scrollToCurrentMatch() {
      if (currentMatchIndex < 0 || currentMatchIndex >= matches.length) return;
      
      const match = matches[currentMatchIndex];
      const textarea = inputText;
      const lineHeight = parseInt(getComputedStyle(textarea).lineHeight);
      const matchLine = getLineNumber(textarea.value, match.start);
      
      textarea.scrollTop = (matchLine - 1) * lineHeight;
    }

    function getLineNumber(text, position) {
      return text.substring(0, position).split('\n').length;
    }

    // ---------- REPLACEMENT FUNCTIONS ----------
    function replaceCurrent() {
      if (currentMatchIndex < 0 || currentMatchIndex >= matches.length) return;
      
      const match = matches[currentMatchIndex];
      const text = inputText.value;
      const replacement = replaceText.value || '';
      
      const newText = text.substring(0, match.start) + replacement + text.substring(match.end);
      inputText.value = newText;
      
      // Update matches after replacement
      const offset = replacement.length - (match.end - match.start);
      updateMatchesAfterReplacement(currentMatchIndex, offset);
      
      findAllMatches();
    }

    function replaceAll() {
      if (matches.length === 0) return;
      
      const text = inputText.value;
      const replacement = replaceText.value || '';
      let newText = text;
      let offset = 0;
      
      // Replace all matches from last to first to maintain positions
      for (let i = matches.length - 1; i >= 0; i--) {
        const match = matches[i];
        newText = newText.substring(0, match.start) + replacement + newText.substring(match.end);
        offset = replacement.length - (match.end - match.start);
      }
      
      inputText.value = newText;
      clearMatches();
      showStatus(`Replaced ${matches.length} occurrence${matches.length !== 1 ? 's' : ''}`, 'success');
    }

    function updateMatchesAfterReplacement(replacedIndex, offset) {
      // Update positions of matches after the replaced one
      for (let i = replacedIndex + 1; i < matches.length; i++) {
        matches[i].start += offset;
        matches[i].end += offset;
      }
      
      // Remove the replaced match
      matches.splice(replacedIndex, 1);
    }

    // ---------- PREVIEW FUNCTIONS ----------
    function showPreview() {
      if (!findText.value) {
        showStatus('Please enter text to find', 'error');
        return;
      }
      
      try {
        const text = inputText.value;
        const find = findText.value;
        const replacement = replaceText.value || '';
        
        previewResult = applyReplacements(text, find, replacement);
        
        // Show original with highlights and modified text
        originalPreview.innerHTML = generatePreviewHTML(text, find, true);
        modifiedPreview.innerHTML = generatePreviewHTML(previewResult, find, false);
        
        previewSection.classList.add('active');
        applyPreviewBtn.disabled = false;
      } catch (error) {
        showStatus(`Invalid regex pattern: ${error.message}`, 'error');
      }
    }

    function hidePreview() {
      previewSection.classList.remove('active');
    }

    function applyPreview() {
      if (previewResult) {
        inputText.value = previewResult;
        hidePreview();
        findAllMatches();
        showStatus('Preview applied successfully', 'success');
      }
    }

    function applyReplacements(text, find, replacement) {
      if (!find) return text;
      
      let flags = 'g';
      if (!caseSensitive.checked) flags += 'i';
      
      let pattern = find;
      
      if (useRegex.checked) {
        try {
          new RegExp(pattern, flags);
        } catch (e) {
          throw new Error('Invalid regular expression');
        }
      } else {
        pattern = find.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        
        if (wholeWord.checked) {
          pattern = `\\b${pattern}\\b`;
        }
      }
      
      const regex = new RegExp(pattern, flags);
      return text.replace(regex, replacement);
    }

    function generatePreviewHTML(text, find, showHighlights) {
      if (!showHighlights || !find) return escapeHtml(text);
      
      try {
        const matches = findMatches(text, find);
        let html = '';
        let lastIndex = 0;
        
        matches.forEach(match => {
          // Add text before match
          html += escapeHtml(text.substring(lastIndex, match.start));
          
          if (showHighlights) {
            // Add highlighted match
            html += `<span class="replacement">${escapeHtml(text.substring(match.start, match.end))}</span>`;
          } else {
            // Add replacement
            const replacement = replaceText.value || '';
            html += `<span class="replacement">${escapeHtml(replacement)}</span>`;
          }
          
          lastIndex = match.end;
        });
        
        // Add remaining text
        html += escapeHtml(text.substring(lastIndex));
        
        return html;
      } catch (error) {
        return escapeHtml(text);
      }
    }

    // ---------- UTILITY FUNCTIONS ----------
    function updateMatchInfo() {
      if (matches.length > 0) {
        matchInfo.style.display = 'flex';
        matchCount.textContent = `${matches.length} match${matches.length !== 1 ? 'es' : ''} found`;
        currentMatch.textContent = `${currentMatchIndex + 1} of ${matches.length}`;
        
        prevMatch.disabled = matches.length <= 1;
        nextMatch.disabled = matches.length <= 1;
      } else {
        matchInfo.style.display = 'none';
      }
    }

    function updateButtonStates() {
      const hasMatches = matches.length > 0;
      const hasFindText = findText.value.length > 0;
      const hasInputText = inputText.value.length > 0;
      
      replaceBtn.disabled = !hasMatches || currentMatchIndex < 0;
      replaceAllBtn.disabled = !hasMatches;
      copyBtn.disabled = !hasInputText;
      previewBtn.disabled = !hasFindText || !hasInputText;
    }

    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status-message active status-${type}`;
      
      setTimeout(() => {
        statusMessage.classList.remove('active');
      }, 3000);
    }

    function copyResult() {
      if (!inputText.value) return;
      
      navigator.clipboard.writeText(inputText.value).then(() => {
        copyToast.classList.add('show');
        setTimeout(() => {
          copyToast.classList.remove('show');
        }, 3000);
      }).catch(err => {
        console.error('Failed to copy text: ', err);
        showStatus('Failed to copy text to clipboard', 'error');
      });
    }

    function resetAll() {
      inputText.value = '';
      findText.value = '';
      replaceText.value = '';
      clearMatches();
      hidePreview();
      statusMessage.classList.remove('active');
      updateButtonStates();
      inputText.focus();
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ---------- THEME TOGGLE ----------
    const themeToggle = document.getElementById("themeToggle");
    const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
    
    // Check for saved theme preference or use device preference
    const currentTheme = localStorage.getItem("theme") || 
                        (prefersDarkScheme.matches ? "dark" : "light");
    
    if (currentTheme === "light") {
      document.body.classList.add("light-mode");
    }
    
    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("light-mode");
      
      // Save theme preference
      const theme = document.body.classList.contains("light-mode") ? "light" : "dark";
      localStorage.setItem("theme", theme);
    });

    // Initialize the tool when the page loads
    document.addEventListener('DOMContentLoaded', initializeTool);
  </script>
</body>
</html>

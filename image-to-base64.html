<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Image to Base64 Converter</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* --------- RESET & VARIABLES --------- */
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      font-family: "Poppins", sans-serif; 
      transition: background-color 0.3s, color 0.3s;
    }

    :root {
      --primary: #38bdf8;
      --primary-dark: #0ea5e9;
      --secondary: #f472b6;
      --accent: #a78bfa;
      --bg: #0f172a;
      --bg-light: #1e293b;
      --bg-lighter: #334155;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --card-bg: rgba(255, 255, 255, 0.05);
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --border: rgba(255, 255, 255, 0.1);
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
    }

    .light-mode {
      --bg: #f8fafc;
      --bg-light: #e2e8f0;
      --bg-lighter: #cbd5e1;
      --text: #0f172a;
      --text-muted: #475569;
      --card-bg: rgba(255, 255, 255, 0.8);
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
      --border: rgba(0, 0, 0, 0.1);
    }

    body {
      background: linear-gradient(135deg, var(--bg), var(--bg-light));
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background 0.5s ease;
      padding: 0 1rem;
    }

    /* --------- HEADER & NAVIGATION --------- */
    header {
      width: 100%;
      padding: 1.5rem 1rem;
      text-align: center;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      position: relative;
      z-index: 100;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo i {
      font-size: 2.5rem;
      color: var(--primary);
      animation: rotate 10s linear infinite;
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .logo h1 {
      font-size: 2rem;
      color: var(--primary);
      letter-spacing: 1px;
    }

    .logo p {
      margin-top: 0.5rem;
      color: var(--text-muted);
      font-size: 1rem;
    }

    .theme-toggle {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 50px;
      width: 60px;
      height: 30px;
      position: relative;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 0 5px;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.05);
    }

    .theme-toggle i {
      position: absolute;
      font-size: 1.2rem;
      transition: all 0.3s ease;
    }

    .theme-toggle .fa-sun {
      color: #f59e0b;
      opacity: 0;
    }

    .theme-toggle .fa-moon {
      color: #94a3b8;
    }

    .light-mode .theme-toggle .fa-sun {
      opacity: 1;
    }

    .light-mode .theme-toggle .fa-moon {
      opacity: 0;
    }

    .theme-toggle::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary);
      transition: all 0.3s ease;
      left: 4px;
    }

    .light-mode .theme-toggle::after {
      left: calc(100% - 26px);
      background: #f59e0b;
    }

    /* --------- MAIN CONTENT --------- */
    .main-content {
      max-width: 1000px;
      width: 100%;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .converter-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      margin-bottom: 2rem;
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .card-header h2 {
      font-size: 1.8rem;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .card-header p {
      color: var(--text-muted);
    }

    .card-header i {
      font-size: 3rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    /* --------- UPLOAD AREA --------- */
    .upload-area {
      border: 2px dashed var(--border);
      border-radius: 15px;
      padding: 3rem 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 2rem;
      background: var(--bg-light);
    }

    .upload-area:hover {
      border-color: var(--primary);
      background: var(--bg-lighter);
      transform: translateY(-2px);
    }

    .upload-area.dragover {
      border-color: var(--success);
      background: rgba(16, 185, 129, 0.1);
    }

    .upload-icon {
      font-size: 4rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .upload-text {
      font-size: 1.2rem;
      color: var(--text);
      margin-bottom: 0.5rem;
    }

    .upload-subtext {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .file-input {
      display: none;
    }

    /* --------- PREVIEW GRID --------- */
    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .preview-item {
      background: var(--bg-light);
      border-radius: 10px;
      padding: 1rem;
      border: 1px solid var(--border);
      animation: fadeIn 0.5s ease;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .preview-filename {
      font-weight: 600;
      color: var(--text);
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }

    .preview-actions {
      display: flex;
      gap: 0.5rem;
    }

    .action-btn {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--text);
    }

    .action-btn:hover {
      transform: scale(1.1);
    }

    .action-btn.remove:hover {
      background: var(--error);
      color: white;
    }

    .preview-image {
      width: 100%;
      height: 150px;
      object-fit: contain;
      background: var(--bg-lighter);
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .file-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    .base64-output {
      margin-top: 1rem;
    }

    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      cursor: pointer;
    }

    .output-title {
      font-weight: 600;
      color: var(--text);
      font-size: 0.9rem;
    }

    .output-toggle {
      color: var(--primary);
      transition: transform 0.3s ease;
    }

    .output-toggle.collapsed {
      transform: rotate(-90deg);
    }

    .base64-textarea {
      width: 100%;
      min-height: 100px;
      padding: 1rem;
      border: none;
      border-radius: 8px;
      background: var(--bg-lighter);
      color: var(--text);
      font-family: monospace;
      font-size: 0.8rem;
      resize: vertical;
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }

    .base64-textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
    }

    .base64-textarea.collapsed {
      display: none;
    }

    /* --------- BUTTONS --------- */
    .button-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .btn {
      padding: 1rem 1.5rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #0da271;
      transform: translateY(-3px);
    }

    .btn-secondary {
      background: var(--bg-lighter);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-light);
      transform: translateY(-3px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* --------- STATUS MESSAGES --------- */
    .status-message {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      display: none;
    }

    .status-message.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .status-success {
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid var(--success);
      color: var(--success);
    }

    .status-error {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid var(--error);
      color: var(--error);
    }

    .status-info {
      background: rgba(56, 189, 248, 0.2);
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    /* --------- PROGRESS INDICATOR --------- */
    .progress-container {
      background: var(--bg-light);
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border);
      display: none;
    }

    .progress-container.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .progress-title {
      font-weight: 600;
      color: var(--text);
    }

    .progress-bar {
      height: 8px;
      background: var(--bg-lighter);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .progress-text {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
    }

    /* --------- MESSAGE TOAST --------- */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      background: var(--success);
      color: white;
      border-radius: 10px;
      box-shadow: var(--card-shadow);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* --------- BACK BUTTON --------- */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.8rem 1.5rem;
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      margin-top: 1rem;
    }

    .back-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateX(-5px);
    }

    /* --------- SECURITY NOTE --------- */
    .security-note {
      text-align: center;
      color: var(--text-muted);
      font-size: 0.8rem;
      margin-top: 2rem;
      padding: 1rem;
      background: var(--bg-light);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    /* --------- FOOTER --------- */
    footer {
      padding: 2rem 1rem;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      width: 100%;
      margin-top: auto;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .footer-links {
      display: flex;
      gap: 2rem;
      margin-top: 1rem;
    }

    .footer-links a {
      color: var(--text-muted);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-links a:hover {
      color: var(--primary);
    }

    /* --------- RESPONSIVE DESIGN --------- */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
      }

      .button-group {
        grid-template-columns: 1fr;
      }

      .preview-grid {
        grid-template-columns: 1fr;
      }

      .upload-area {
        padding: 2rem 1rem;
      }

      .upload-icon {
        font-size: 3rem;
      }
    }

    @media (max-width: 480px) {
      .converter-card {
        padding: 1.5rem;
      }

      .preview-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .preview-actions {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        <i class="fas fa-toolbox"></i>
        <div>
          <h1>All-in-One Tools</h1>
          <p>50+ useful tools for your everyday needs</p>
        </div>
      </div>
      <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-sun"></i>
        <i class="fas fa-moon"></i>
      </div>
    </div>
  </header>

  <div class="main-content">
    <div class="converter-card">
      <div class="card-header">
        <i class="fas fa-image"></i>
        <h2>Image to Base64 Converter</h2>
        <p>Convert your images to Base64 format instantly in your browser</p>
      </div>

      <div class="status-message" id="statusMessage"></div>

      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">
          <i class="fas fa-cloud-upload-alt"></i>
        </div>
        <div class="upload-text">Drop images here or click to upload</div>
        <div class="upload-subtext">Supports JPG, PNG, GIF, WEBP, SVG • Max 10MB per file</div>
        <input type="file" id="fileInput" class="file-input" accept=".jpg,.jpeg,.png,.gif,.webp,.svg" multiple>
      </div>

      <div class="progress-container" id="progressContainer">
        <div class="progress-header">
          <div class="progress-title">Converting Images</div>
          <div class="progress-percent" id="progressPercent">0%</div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Processing 0 of 0 images</div>
      </div>

      <div class="preview-grid" id="previewGrid">
        <!-- Image previews will be dynamically added here -->
      </div>

      <div class="button-group">
        <button class="btn btn-primary" id="convertBtn">
          <i class="fas fa-code"></i> Convert to Base64
        </button>
        <button class="btn btn-success" id="downloadAllBtn" disabled>
          <i class="fas fa-download"></i> Download All as .txt
        </button>
        <button class="btn btn-secondary" id="resetBtn">
          <i class="fas fa-redo"></i> Reset
        </button>
      </div>

      <div class="security-note">
        <i class="fas fa-shield-alt"></i> All conversions happen locally in your browser. No images are uploaded to any server.
      </div>

      <a href="index.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> Back to Home
      </a>
    </div>
  </div>

  <footer>
    <div class="footer-content">
      <p>© 2025 Prabin's Toolbox | All Rights Reserved</p>
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Terms of Service</a>
        <a href="#">Contact Us</a>
      </div>
    </div>
  </footer>

  <div class="toast" id="copyToast">
    <i class="fas fa-check-circle"></i>
    <span>Base64 copied to clipboard!</span>
  </div>

  <script>
    // Security note: All image processing happens client-side only.
    // No image data is transmitted to any server - everything remains on your device.

    // ---------- DOM ELEMENTS ----------
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const previewGrid = document.getElementById('previewGrid');
    const convertBtn = document.getElementById('convertBtn');
    const downloadAllBtn = document.getElementById('downloadAllBtn');
    const resetBtn = document.getElementById('resetBtn');
    const statusMessage = document.getElementById('statusMessage');
    const progressContainer = document.getElementById('progressContainer');
    const progressFill = document.getElementById('progressFill');
    const progressPercent = document.getElementById('progressPercent');
    const progressText = document.getElementById('progressText');
    const copyToast = document.getElementById('copyToast');

    // ---------- STATE VARIABLES ----------
    let uploadedFiles = [];
    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB

    // ---------- INITIALIZATION ----------
    function initializeConverter() {
      setupEventListeners();
    }

    function setupEventListeners() {
      // File input events
      uploadArea.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', handleFileSelect);
      
      // Drag and drop events
      uploadArea.addEventListener('dragover', handleDragOver);
      uploadArea.addEventListener('dragleave', handleDragLeave);
      uploadArea.addEventListener('drop', handleDrop);
      
      // Button events
      convertBtn.addEventListener('click', convertAllToBase64);
      downloadAllBtn.addEventListener('click', downloadAllBase64);
      resetBtn.addEventListener('click', resetConverter);
    }

    // ---------- FILE HANDLING ----------
    function handleFileSelect(event) {
      const files = Array.from(event.target.files);
      processFiles(files);
    }

    function handleDragOver(event) {
      event.preventDefault();
      uploadArea.classList.add('dragover');
    }

    function handleDragLeave(event) {
      event.preventDefault();
      uploadArea.classList.remove('dragover');
    }

    function handleDrop(event) {
      event.preventDefault();
      uploadArea.classList.remove('dragover');
      
      const files = Array.from(event.dataTransfer.files);
      processFiles(files);
    }

    function processFiles(files) {
      const validFiles = [];
      const errors = [];
      
      files.forEach(file => {
        // Validate file type
        if (!isValidImageType(file)) {
          errors.push(`"${file.name}" - Unsupported file type`);
          return;
        }
        
        // Validate file size
        if (file.size > MAX_FILE_SIZE) {
          errors.push(`"${file.name}" - File too large (max 10MB)`);
          return;
        }
        
        validFiles.push(file);
      });
      
      // Show errors if any
      if (errors.length > 0) {
        showStatus(errors.join('<br>'), 'error');
      }
      
      // Process valid files
      if (validFiles.length > 0) {
        uploadedFiles = [...uploadedFiles, ...validFiles];
        renderPreviews();
        updateButtonStates();
        showStatus(`Added ${validFiles.length} image(s)`, 'success');
      }
    }

    function isValidImageType(file) {
      const validTypes = [
        'image/jpeg',
        'image/jpg',
        'image/png',
        'image/gif',
        'image/webp',
        'image/svg+xml'
      ];
      return validTypes.includes(file.type);
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // ---------- PREVIEW RENDERING ----------
    function renderPreviews() {
      previewGrid.innerHTML = '';
      
      uploadedFiles.forEach((file, index) => {
        const previewItem = createPreviewItem(file, index);
        previewGrid.appendChild(previewItem);
      });
    }

    function createPreviewItem(file, index) {
      const item = document.createElement('div');
      item.className = 'preview-item';
      item.innerHTML = `
        <div class="preview-header">
          <div class="preview-filename" title="${file.name}">${file.name}</div>
          <div class="preview-actions">
            <button class="action-btn remove" data-index="${index}" title="Remove">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <img class="preview-image" src="#" alt="${file.name}" data-index="${index}">
        <div class="file-info">
          <span>Size: ${formatFileSize(file.size)}</span>
          <span class="base64-size" id="base64Size-${index}">-</span>
        </div>
        <div class="base64-output">
          <div class="output-header">
            <div class="output-title">Base64 Code</div>
            <div class="output-toggle">
              <i class="fas fa-chevron-down"></i>
            </div>
          </div>
          <textarea 
            class="base64-textarea" 
            id="base64Output-${index}" 
            readonly 
            placeholder="Base64 code will appear here after conversion..."
          ></textarea>
          <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
            <button class="btn btn-secondary btn-small copy-base64" data-index="${index}" style="padding: 0.5rem 1rem; font-size: 0.8rem;">
              <i class="fas fa-copy"></i> Copy
            </button>
          </div>
        </div>
      `;
      
      // Load image preview
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = item.querySelector('.preview-image');
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
      
      // Add event listeners
      const removeBtn = item.querySelector('.remove');
      const toggleBtn = item.querySelector('.output-toggle');
      const textarea = item.querySelector('.base64-textarea');
      const copyBtn = item.querySelector('.copy-base64');
      
      removeBtn.addEventListener('click', () => removeFile(index));
      toggleBtn.addEventListener('click', () => toggleOutput(index));
      textarea.addEventListener('click', () => selectBase64Text(index));
      copyBtn.addEventListener('click', () => copyBase64ToClipboard(index));
      
      return item;
    }

    function removeFile(index) {
      uploadedFiles.splice(index, 1);
      renderPreviews();
      updateButtonStates();
      
      if (uploadedFiles.length === 0) {
        showStatus('All images removed', 'info');
      }
    }

    function toggleOutput(index) {
      const textarea = document.getElementById(`base64Output-${index}`);
      const toggle = document.querySelector(`[data-index="${index}"]`).closest('.preview-item').querySelector('.output-toggle');
      
      textarea.classList.toggle('collapsed');
      toggle.classList.toggle('collapsed');
    }

    function selectBase64Text(index) {
      const textarea = document.getElementById(`base64Output-${index}`);
      textarea.select();
    }

    // ---------- BASE64 CONVERSION ----------
    function convertAllToBase64() {
      if (uploadedFiles.length === 0) {
        showStatus('Please upload images first', 'error');
        return;
      }
      
      showProgress(0, uploadedFiles.length);
      progressContainer.classList.add('active');
      
      let processedCount = 0;
      
      uploadedFiles.forEach((file, index) => {
        convertToBase64(file, index)
          .then(() => {
            processedCount++;
            updateProgress(processedCount, uploadedFiles.length);
            
            if (processedCount === uploadedFiles.length) {
              progressContainer.classList.remove('active');
              showStatus('All images converted to Base64', 'success');
              downloadAllBtn.disabled = false;
            }
          })
          .catch(error => {
            processedCount++;
            updateProgress(processedCount, uploadedFiles.length);
            console.error(`Error converting ${file.name}:`, error);
            showStatus(`Error converting ${file.name}`, 'error');
          });
      });
    }

    function convertToBase64(file, index) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          const base64String = e.target.result;
          const textarea = document.getElementById(`base64Output-${index}`);
          const sizeElement = document.getElementById(`base64Size-${index}`);
          
          textarea.value = base64String;
          sizeElement.textContent = `Base64: ${formatFileSize(base64String.length)}`;
          
          // Auto-expand the output
          const toggle = document.querySelector(`[data-index="${index}"]`).closest('.preview-item').querySelector('.output-toggle');
          const outputArea = document.querySelector(`[data-index="${index}"]`).closest('.preview-item').querySelector('.base64-textarea');
          outputArea.classList.remove('collapsed');
          toggle.classList.remove('collapsed');
          
          resolve();
        };
        
        reader.onerror = function() {
          reject(new Error(`Failed to read file: ${file.name}`));
        };
        
        reader.readAsDataURL(file);
      });
    }

    // ---------- PROGRESS INDICATOR ----------
    function showProgress(current, total) {
      progressContainer.classList.add('active');
      updateProgress(current, total);
    }

    function updateProgress(current, total) {
      const percent = Math.round((current / total) * 100);
      progressFill.style.width = `${percent}%`;
      progressPercent.textContent = `${percent}%`;
      progressText.textContent = `Processing ${current} of ${total} images`;
    }

    // ---------- DOWNLOAD FUNCTIONS ----------
    function downloadAllBase64() {
      if (uploadedFiles.length === 0) return;
      
      let content = '';
      const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];
      
      uploadedFiles.forEach((file, index) => {
        const base64Output = document.getElementById(`base64Output-${index}`);
        if (base64Output && base64Output.value) {
          content += `// ${file.name}\n`;
          content += `${base64Output.value}\n\n`;
        }
      });
      
      if (!content) {
        showStatus('No Base64 data to download', 'error');
        return;
      }
      
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `base64-images-${timestamp}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showStatus('Base64 data downloaded as text file', 'success');
    }

    function copyBase64ToClipboard(index) {
      const textarea = document.getElementById(`base64Output-${index}`);
      
      if (!textarea || !textarea.value) {
        showStatus('No Base64 data to copy', 'error');
        return;
      }
      
      navigator.clipboard.writeText(textarea.value)
        .then(() => {
          copyToast.classList.add('show');
          setTimeout(() => {
            copyToast.classList.remove('show');
          }, 3000);
        })
        .catch(err => {
          console.error('Failed to copy text: ', err);
          showStatus('Failed to copy to clipboard', 'error');
        });
    }

    // ---------- UTILITY FUNCTIONS ----------
    function updateButtonStates() {
      convertBtn.disabled = uploadedFiles.length === 0;
      downloadAllBtn.disabled = uploadedFiles.length === 0;
    }

    function resetConverter() {
      uploadedFiles = [];
      previewGrid.innerHTML = '';
      fileInput.value = '';
      progressContainer.classList.remove('active');
      downloadAllBtn.disabled = true;
      showStatus('Converter reset', 'info');
    }

    function showStatus(message, type) {
      statusMessage.innerHTML = message;
      statusMessage.className = `status-message active status-${type}`;
      
      setTimeout(() => {
        statusMessage.classList.remove('active');
      }, 5000);
    }

    // ---------- THEME TOGGLE ----------
    const themeToggle = document.getElementById("themeToggle");
    const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
    
    // Check for saved theme preference or use device preference
    const currentTheme = localStorage.getItem("theme") || 
                        (prefersDarkScheme.matches ? "dark" : "light");
    
    if (currentTheme === "light") {
      document.body.classList.add("light-mode");
    }
    
    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("light-mode");
      
      // Save theme preference
      const theme = document.body.classList.contains("light-mode") ? "light" : "dark";
      localStorage.setItem("theme", theme);
    });

    // Initialize the converter when the page loads
    document.addEventListener('DOMContentLoaded', initializeConverter);
  </script>
</body>
</html>